<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="General description"><title>massa_event_cache - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-c5d6553a23f1e5a6.css"><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="massa_event_cache" data-themes="" data-resource-suffix="" data-rustdoc-version="1.81.0 (eeb90cda1 2024-09-04)" data-channel="1.81.0" data-search-js="search-d234aafac6c221dd.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../static.files/storage-118b08c4c78b968e.js"></script><script defer src="../crates.js"></script><script defer src="../static.files/main-d2fab2bf619172d3.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-df360f571f6edeae.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../massa_event_cache/index.html">massa_event_cache</a><span class="version">3.0.0</span></h2></div><div class="sidebar-elems"><ul class="block"><li><a id="all-types" href="all.html">All Items</a></li></ul><section><ul class="block"><li><a href="#modules">Modules</a></li></ul></section></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><h1>Crate <a class="mod" href="#">massa_event_cache</a><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><span class="out-of-band"><a class="src" href="../src/massa_event_cache/lib.rs.html#3-55">source</a> Â· <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><h2 id="general-description"><a class="doc-anchor" href="#general-description">Â§</a>General description</h2>
<p>A database (build on top of rocksdb) to store final events emitted by:</p>
<ul>
<li>The massa node during execution</li>
<li>A Smart contract during execution</li>
</ul>
<p>The database can also be queried with: get_filtered_sc_output_events</p>
<h2 id="architecture"><a class="doc-anchor" href="#architecture">Â§</a>Architecture</h2>
<ul>
<li>controller.rs / worker.rs: db wrapper controller &amp; worker</li>
<li>rocksdb_operator: a rocksdb operator to handle counter (as u64 counter)</li>
<li>ser_deser.rs: event serializer &amp;&amp; deserializer (using nom)</li>
<li>event_cache: db over rocksdb code</li>
</ul>
<h2 id="dbkeybuilder"><a class="doc-anchor" href="#dbkeybuilder">Â§</a>DBKeyBuilder</h2>
<p>The db use the DbKeyBuilder structure to create the rocksdb keys required for its operations.
There are 3 types of keys:</p>
<ul>
<li>regular key: and the associated value is the event data serialized</li>
<li>prefix key: Key used to iterate in rocksdb</li>
<li>counter key: key used to query count info (example: number of event for operation id X)</li>
</ul>
<p>See <code>key_from_event</code> method for more information about the keys.</p>
<h2 id="db-queries"><a class="doc-anchor" href="#db-queries">Â§</a>Db queries</h2>
<p>WHen inserting an event in the DB, counters are being updated. They are used later when we need
to query the DB in order to query by ordering with counter values (to optimize the DB query plan).</p>
<p>Let say you want to query events for a specific slot range &amp;&amp; an emitter_address, the query method
will first query the counts for each filter item then select the one with fewer rows then select the
other.</p>
<h2 id="snip"><a class="doc-anchor" href="#snip">Â§</a>Snip</h2>
<p>The method snip on the DB must be used to remove items and keep a reasonable DB size. It will remove
the oldest (by slot) items (number is configurable) in the DB.</p>
<h2 id="tests"><a class="doc-anchor" href="#tests">Â§</a>Tests</h2>
<ul>
<li>Check unit tests for info on how to use the DB directly.</li>
</ul>
</div></details><h2 id="modules" class="section-header">Modules<a href="#modules" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="mod" href="config/index.html" title="mod massa_event_cache::config">config</a></div></li><li><div class="item-name"><a class="mod" href="controller/index.html" title="mod massa_event_cache::controller">controller</a></div></li><li><div class="item-name"><a class="mod" href="event_cache/index.html" title="mod massa_event_cache::event_cache">event_cache</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div></li><li><div class="item-name"><a class="mod" href="rocksdb_operator/index.html" title="mod massa_event_cache::rocksdb_operator">rocksdb_operator</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div></li><li><div class="item-name"><a class="mod" href="ser_deser/index.html" title="mod massa_event_cache::ser_deser">ser_deser</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div></li><li><div class="item-name"><a class="mod" href="worker/index.html" title="mod massa_event_cache::worker">worker</a></div></li></ul></section></div></main></body></html>